### 优化系统
#### [15-1]  精细调整栈大小
1. 对于每一个任务，都会分配一个栈，在使用之前会初始化它，即设置一些比较特殊的值0xa5a5a5a5去填满整个栈 
2. 当任务开始运行时，栈内写入数据，覆盖之前特殊的值；而没被覆盖的就是空闲栈空间
3. 当任务运行足够久后，通过统计特殊值的个数得到空闲栈的空间大小，从而调整任务栈大小
4. `uxTaskGetStackHighWaterMark()` 函数查看栈使用情况








#### [15-2]  打印所有任务的栈信息


- 调用函数 `vTaskList()`，获得任务的统计信息，形式为可读的字符串

- 在空闲任务的钩子函数`vApplicationIdleHook()`中去调用以上函数
- 注意：需要在cubemax去开启IDEL-HOCK







#### [15-3]  统计CPU占比找出有问题的任务

- 原理： 统计任务开始与结束的时刻，相减得到任务运行时间，Tick中断是ms级，并不精确
- 因此需要一个更精确的ns级的时刻，函数是 `portGET_RUN_TIME_COUNTER_VALUE()`, 原理是另外一个定时器，同样是1ms中断一次；如果在没到1ms时，当前时间为定时器的（cnt/reload * 1000 000 ）ns

- 调用`vTaskGetRunTimeStats()`获得任务的运行信息
- 通过观察打印的信息，发现MPU6050在没有摇晃的时候占用率就为4%，不科学，应为<1%，因此需要改进



#### [15-4]  改进MPU6050驱动
相关代码: [34_improve_mpu6050](../MDK5/34_improve_mpu6050/Drivers/DshanMCU-F103/driver_mpu6050.c)
- 通过调试发现，不摇晃MPU6050时，也会进中断
- 改进：
  - 1.查看MPU6050的datasheet，重新配置中断寄存器
  - 2.`MPU6050_Task` 修改为如果倾角小于90°，即使没有倾斜开发板产生一个加速度，挡板依然会连续滑动
  











